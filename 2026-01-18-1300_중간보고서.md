# Dual Map Viewer Pro - 중간 보고서

**작성일**: 2026-01-16  
**프로젝트명**: Dual Map Viewer Pro  
**버전**: 1.0

---

## 목차

1. [기능 명세](#1-기능-명세)
2. [콘트롤 명세](#2-콘트롤-명세)
3. [UI/UX 디자인 명세](#3-uiux-디자인-명세)
4. [핵심 로직 명세](#4-핵심-로직-명세)

---

## 1. 기능 명세

### 1.1 핵심 기능

#### 1.1.1 듀얼 맵 동기화
- **기능**: 좌우 두 개의 맵 패널에서 위치, 줌 레벨을 실시간 동기화
- **동작 방식**: 한쪽 맵에서 이동/줌 시 다른 쪽 맵도 자동으로 동일한 위치로 이동
- **지원 맵 제공자**: Google Maps, Kakao Map, Naver Map
- **동기화 항목**:
  - 위도/경도 (lat/lng)
  - 줌 레벨 (zoom)
  - 거리뷰 위치 및 상태

#### 1.1.2 다중 맵 제공자 지원
- **Google Maps**: 위성/일반 지도 모드, Street View 지원
- **Kakao Map**: 위성/일반 지도 모드, 로드뷰 지원, GIS 도구 제공
- **Naver Map**: 위성/일반 지도 모드, 거리뷰(파노라마) 지원

#### 1.1.3 위치 검색
- **검색 API**: Kakao Places API
- **기능**:
  - 실시간 자동완성 검색
  - 검색 결과 드롭다운 표시
  - 최근 검색 기록 저장 (최대 5개, localStorage)
  - 검색 결과 선택 시 두 맵 모두 해당 위치로 이동

#### 1.1.4 거리뷰/로드뷰 기능
- **Google Maps**: Street View (Pegman 컨트롤)
- **Kakao Map**: 로드뷰 (Roadview)
- **Naver Map**: 거리뷰 (Panorama)
- **공통 기능**:
  - 거리뷰 활성화 시 메인 맵이 미니맵으로 전환 (240x240px, 좌하단)
  - 거리뷰 위치와 미니맵 마커 동기화
  - 거리뷰 방향 변경 시 마커 회전 동기화 (방향 비추기)
  - 거리뷰 닫기 버튼

#### 1.1.5 카카오맵 전용 GIS 도구
- **로드뷰 모드**: 지도 클릭으로 로드뷰 시작
- **지적도 오버레이**: 토글 방식
- **거리 측정**: 클릭으로 경로 그리기, 거리 표시
- **면적 측정**: 클릭으로 영역 그리기, 면적 표시
- **초기화**: 모든 그리기 요소 제거

#### 1.1.6 전체화면 모드
- 좌측 또는 우측 패널을 전체화면으로 확대
- 전체화면 토글 버튼으로 전환

### 1.2 부가 기능

#### 1.2.1 위성 이미지 모드
- 각 맵 패널별로 위성/일반 지도 모드 토글
- 독립적인 모드 설정 가능

#### 1.2.2 맵 제공자 선택
- 각 패널별로 맵 제공자 선택 가능
- 좌측/우측 독립 설정

#### 1.2.3 검색 기록 관리
- 최근 검색 5개 저장
- 검색 입력 필드 포커스 시 기록 표시
- 기록 클릭으로 재검색

---

## 2. 콘트롤 명세

### 2.1 헤더 영역 콘트롤

#### 2.1.1 좌측 맵 제공자 선택 (Select)
- **위치**: 헤더 좌측
- **크기**: 높이 28px, 너비 자동
- **기능**: 좌측 패널 맵 제공자 선택 (Google/Kakao/Naver)
- **스타일**: 
  - 배경: 흰색
  - 텍스트: 검은색, 12px
  - 테두리: 회색

#### 2.1.2 좌측 위성 모드 토글 (Button)
- **위치**: 좌측 맵 제공자 선택 옆
- **크기**: 28px × 28px
- **기능**: 좌측 패널 위성/일반 지도 모드 토글
- **아이콘**: 🛰️ (위성) / 🗺️ (일반)
- **스타일**: 흰색 배경, 회색 테두리

#### 2.1.3 검색 입력 필드 (Input)
- **위치**: 헤더 중앙
- **크기**: 높이 28px, 너비 flex-grow (최대 max-w-sm)
- **기능**: 위치 검색 입력
- **플레이스홀더**: "주소/지명"
- **스타일**: 
  - 배경: 흰색
  - 포커스 시: 파란색 테두리
  - 텍스트: 검은색, 14px

#### 2.1.4 검색 지우기 버튼 (Button)
- **위치**: 검색 입력 필드 옆
- **크기**: 28px × 28px
- **기능**: 검색어 및 검색 결과 초기화
- **아이콘**: 🗑️
- **스타일**: 흰색 배경, 회색 테두리

#### 2.1.5 검색 제안 드롭다운 (Dropdown)
- **위치**: 검색 입력 필드 하단
- **크기**: 너비 100%, 최대 높이 240px (overflow-y: auto)
- **기능**: 검색 자동완성 결과 표시
- **표시 항목**: 장소명, 주소
- **스타일**: 
  - 배경: 흰색
  - 호버: 파란색 배경
  - z-index: 10000

#### 2.1.6 검색 기록 드롭다운 (Dropdown)
- **위치**: 검색 입력 필드 하단
- **크기**: 너비 192px (w-48)
- **기능**: 최근 검색 기록 표시 (최대 5개)
- **스타일**: 
  - 배경: 흰색
  - 헤더: 회색 배경
  - z-index: 10000

#### 2.1.7 우측 맵 제공자 선택 (Select)
- **위치**: 헤더 우측
- **크기**: 높이 28px, 너비 자동
- **기능**: 우측 패널 맵 제공자 선택
- **스타일**: 좌측과 동일

#### 2.1.8 우측 위성 모드 토글 (Button)
- **위치**: 우측 맵 제공자 선택 옆
- **크기**: 28px × 28px
- **기능**: 우측 패널 위성/일반 지도 모드 토글
- **스타일**: 좌측과 동일

#### 2.1.9 Padlet 링크 (Link)
- **위치**: 헤더 최우측 (ml-auto)
- **크기**: 자동
- **기능**: 외부 Padlet 페이지로 이동
- **스타일**: 
  - 배경: 투명
  - 테두리: 청록색 (#4DC4FF)
  - 텍스트: 청록색, 12px, 굵게
  - 호버: 청록색 배경, 흰색 텍스트

### 2.2 맵 패널 영역 콘트롤

#### 2.2.1 전체화면 버튼 (Button)
- **위치**: 
  - 거리뷰 비활성화: 
    - 카카오맵: `top-4 right-[280px]` (280px 오른쪽)
    - 구글맵: `top-4 right-16` (64px 오른쪽)
    - 네이버맵: `top-4 right-4` (16px 오른쪽)
  - 거리뷰 활성화: `top-4 right-16` (모든 맵 공통)
- **크기**: 패딩 6px (p-1.5), 아이콘 20px × 20px
- **기능**: 해당 패널 전체화면 모드 토글
- **아이콘**: 
  - 전체화면 모드: 축소 아이콘
  - 일반 모드: 확대 아이콘
- **스타일**: 
  - 배경: 흰색
  - 테두리: 회색
  - z-index: 110

#### 2.2.2 거리뷰 닫기 버튼 (Button)
- **위치**: `top-4 right-4` (우상단)
- **크기**: 40px × 40px (w-10 h-10)
- **기능**: 거리뷰 종료 및 메인 맵 복원
- **표시 조건**: 거리뷰 활성화 시에만 표시
- **아이콘**: X 아이콘 (SVG)
- **스타일**: 
  - 배경: 흰색
  - 테두리: 회색
  - z-index: 110

#### 2.2.3 네이버 거리뷰 토글 버튼 (Button)
- **위치**: 
  - 거리뷰 비활성화: `top-4 right-16`
  - 거리뷰 활성화: `top-4 right-28`
- **크기**: 40px × 40px (w-10 h-10)
- **기능**: 네이버 거리뷰 레이어 활성화/비활성화
- **표시 조건**: 네이버맵일 때만 표시
- **아이콘**: 카메라 아이콘 (SVG)
- **스타일**: 
  - 활성화: 파란색 배경 (#3B82F6), 흰색 텍스트
  - 비활성화: 흰색 배경, 회색 텍스트
  - z-index: 110

#### 2.2.4 카카오맵 GIS 툴바 (Toolbar)
- **위치**: `top-4 right-[300px]` (우상단, 전체화면 버튼과 중첩 방지)
- **크기**: 각 버튼 36px × 32px (w-9 h-8), 총 너비 약 180px
- **기능**: 5개의 GIS 도구 버튼 집합
- **표시 조건**: 카카오맵일 때만 표시
- **버튼 구성**:
  1. **로드뷰 버튼** (📷)
     - 기능: 로드뷰 모드 활성화
     - 활성화 시: 파란색 배경
  2. **지적도 버튼** (🗺️)
     - 기능: 지적도 오버레이 토글
  3. **거리 재기 버튼** (📏)
     - 기능: 거리 측정 모드 활성화
     - 활성화 시: 파란색 배경
  4. **면적 재기 버튼** (📐)
     - 기능: 면적 측정 모드 활성화
     - 활성화 시: 파란색 배경
  5. **초기화 버튼** (🗑️)
     - 기능: 모든 그리기 요소 제거
     - 스타일: 빨간색 텍스트
- **스타일**: 
  - 배경: 흰색
  - 테두리: 회색
  - 그림자: shadow-lg
  - z-index: 20

#### 2.2.5 미니맵 컨테이너 (Container)
- **위치**: `bottom-3 left-3` (좌하단)
- **크기**: 240px × 240px (w-[240px] h-[240px])
- **기능**: 거리뷰 활성화 시 메인 맵을 미니맵으로 표시
- **표시 조건**: 거리뷰 활성화 시에만 표시
- **스타일**: 
  - 테두리: 4px 흰색, 둥근 모서리
  - 그림자: shadow-2xl
  - z-index: 100
  - 트랜지션: 300ms ease-in-out

#### 2.2.6 구글맵 Pegman 컨트롤
- **위치**: 우상단 (구글맵 API 기본 컨트롤)
- **기능**: Street View 활성화
- **제어**: `streetViewControlOptions: { position: TOP_RIGHT }`

### 2.3 거리뷰 내부 마커

#### 2.3.1 카카오맵 Walker (CustomOverlay)
- **위치**: 로드뷰 위치 (PanoID point) 중심
- **크기**: 26px × 46px
- **기능**: 
  - 로드뷰 위치 표시
  - 로드뷰 방향에 따라 회전 (방향 비추기)
- **앵커**: yAnchor: 0.5 (중심 기준)
- **이미지**: 카카오맵 공식 walker 이미지
- **회전 중심**: center center

#### 2.3.2 네이버맵 Marker
- **위치**: 거리뷰 위치 (Panorama position) 중심
- **크기**: 24px × 24px
- **기능**: 
  - 거리뷰 위치 표시
  - 거리뷰 방향에 따라 회전 (방향 비추기)
- **앵커**: 중심 (size/2, size/2)
- **아이콘**: 빨간색 삼각형 SVG
- **회전**: pov.pan 각도에 따라 동기화

---

## 3. UI/UX 디자인 명세

### 3.1 전체 레이아웃

#### 3.1.1 구조
```
┌─────────────────────────────────────────┐
│           Header (고정 높이)             │
├──────────────────┬──────────────────────┤
│                  │                      │
│   Left Pane      │    Right Pane        │
│   (MapPane)      │    (MapPane)         │
│                  │                      │
│                  │                      │
└──────────────────┴──────────────────────┘
```

#### 3.1.2 반응형 디자인
- **데스크톱**: 좌우 분할 레이아웃 (flex-row)
- **모바일**: 상하 분할 레이아웃 (flex-col)
- **전체화면 모드**: 선택된 패널만 전체 화면 표시

### 3.2 색상 체계

#### 3.2.1 주요 색상
- **헤더 배경**: #222 (어두운 회색)
- **헤더 텍스트**: 흰색
- **맵 패널 배경**: 회색 (#F9FAFB)
- **콘트롤 배경**: 흰색
- **콘트롤 테두리**: 회색 (#D1D5DB)
- **활성 상태**: 파란색 (#3B82F6)
- **링크 색상**: 청록색 (#4DC4FF)
- **에러/삭제**: 빨간색 (#EF4444)

#### 3.2.2 호버 효과
- **버튼**: 배경색 변경 (hover:bg-gray-100)
- **링크**: 배경색 채우기 및 텍스트 색상 반전
- **드롭다운 항목**: 파란색 배경 (hover:bg-blue-50)

### 3.3 타이포그래피

- **폰트 패밀리**: 시스템 기본 (font-sans)
- **헤더 텍스트**: 12px (text-xs)
- **검색 입력**: 14px (text-sm)
- **드롭다운**: 12px (text-sm)
- **드롭다운 부제목**: 12px (text-xs), 회색

### 3.4 간격 및 크기

#### 3.4.1 패딩/마진
- **헤더**: 6px (p-1.5)
- **콘트롤 간격**: 4px (gap-1)
- **미니맵 여백**: 12px (bottom-3 left-3)

#### 3.4.2 버튼 크기
- **표준 버튼**: 28px × 28px (h-[28px] w-[28px])
- **큰 버튼**: 40px × 40px (w-10 h-10)
- **GIS 툴바 버튼**: 36px × 32px (w-9 h-8)

### 3.5 트랜지션 및 애니메이션

#### 3.5.1 트랜지션
- **미니맵 전환**: 300ms ease-in-out
- **거리뷰 표시**: 300ms opacity transition
- **전체화면 전환**: 300ms ease-in-out
- **버튼 호버**: transition-colors

#### 3.5.2 애니메이션
- **드롭다운 표시**: 즉시 (트랜지션 없음)
- **로딩 표시**: 중앙 정렬 텍스트

### 3.6 그림자 및 테두리

#### 3.6.1 그림자
- **헤더**: shadow-md
- **드롭다운**: shadow-xl
- **GIS 툴바**: shadow-lg
- **미니맵**: shadow-2xl

#### 3.6.2 테두리
- **표준 테두리**: 1px 회색 (border border-gray-300)
- **미니맵 테두리**: 4px 흰색 (border-4 border-white)
- **둥근 모서리**: 4px (rounded) 또는 8px (rounded-lg)

### 3.7 z-index 계층

- **헤더**: 9999
- **드롭다운**: 10000
- **거리뷰 닫기/전체화면**: 110
- **미니맵**: 100
- **거리뷰 컨테이너**: 10
- **GIS 툴바**: 20
- **로딩 오버레이**: 120

---

## 4. 핵심 로직 명세

### 4.1 맵 동기화 로직

#### 4.1.1 상태 관리 구조
```typescript
// 전역 상태
globalState: {
  lat: number;
  lng: number;
  zoom: number;
}

// 각 MapPane에서
- globalState 변경 감지 → 맵 위치/줌 업데이트
- 맵 드래그/줌 변경 → globalState 업데이트
- isDragging 플래그로 무한 루프 방지
```

#### 4.1.2 동기화 흐름
1. **사용자 액션**: 한쪽 맵에서 드래그/줌
2. **이벤트 감지**: `center_changed`, `zoom_changed` 이벤트
3. **상태 업데이트**: `onStateChange` 콜백 호출
4. **전역 상태 업데이트**: `App.tsx`에서 `globalState` 업데이트
5. **다른 맵 동기화**: `useEffect`로 `globalState` 변경 감지하여 다른 맵 업데이트
6. **무한 루프 방지**: `isProgrammaticUpdate` 플래그 사용

#### 4.1.3 줌 레벨 변환
- **카카오맵**: 카카오 레벨(1-14) ↔ 표준 줌(3-20) 변환
  - `zoomToKakao(z)`: 표준 줌 → 카카오 레벨
  - `kakaoToZoom(l)`: 카카오 레벨 → 표준 줌

### 4.2 거리뷰 동기화 로직

#### 4.2.1 거리뷰 상태 관리
```typescript
streetViewState: {
  lat: number;
  lng: number;
  active: boolean;
}
```

#### 4.2.2 동기화 흐름
1. **거리뷰 시작**: 한쪽 패널에서 거리뷰 활성화
2. **상태 업데이트**: `onStreetViewChange` 콜백 호출
3. **전역 상태 업데이트**: `App.tsx`에서 `streetViewState` 업데이트
4. **다른 패널 동기화**: `useEffect`로 `streetViewState` 변경 감지
5. **위치 동기화**: 거리뷰 위치 변경 시 양쪽 모두 업데이트

#### 4.2.3 미니맵 전환 로직
- **거리뷰 활성화**: 메인 맵 → 미니맵 (240x240px, 좌하단)
- **트랜지션**: 300ms ease-in-out
- **리사이즈 처리**: 맵 API의 `resize` 이벤트 트리거

### 4.3 카카오맵 로드뷰 로직

#### 4.3.1 로드뷰 시작
1. **GIS 툴바에서 로드뷰 모드 활성화**
2. **지도에 ROADVIEW 오버레이 추가**
3. **지도 클릭 이벤트 리스너 등록**
4. **클릭 위치에서 가장 가까운 PanoID 검색** (`getNearestPanoId`)
5. **로드뷰 컨테이너에 Roadview 인스턴스 생성**
6. **Walker 오버레이 생성** (위치, 방향 포함)

#### 4.3.2 Walker 동기화
- **위치 동기화**: `position_changed` 이벤트로 Walker 위치 업데이트
- **방향 동기화**: `viewpoint_changed` 이벤트로 Walker 회전
- **회전 중심**: center center
- **앵커**: yAnchor: 0.5 (중심 기준)

#### 4.3.3 거리 측정 로직
- **모드**: DISTANCE
- **작동 방식**:
  1. 지도 클릭으로 경로 포인트 추가
  2. 마우스 이동 시 실시간 거리 표시 (플로우팅 오버레이)
  3. 우클릭으로 측정 종료 및 총 거리 표시
- **거리 계산**: Haversine 공식 사용

#### 4.3.4 면적 측정 로직
- **모드**: AREA
- **작동 방식**:
  1. 지도 클릭으로 영역 포인트 추가
  2. 마우스 이동 시 실시간 면적 표시 (플로우팅 오버레이)
  3. 우클릭으로 측정 종료 및 총 면적 표시
- **면적 계산**: 카카오맵 API의 `getArea()` 메서드 사용

### 4.4 네이버맵 거리뷰 로직

#### 4.4.1 거리뷰 시작
1. **거리뷰 버튼 클릭**: StreetLayer 활성화
2. **지도 클릭 이벤트 리스너 등록**
3. **클릭 위치에서 Panorama 인스턴스 생성**
4. **마커 생성** (삼각형, 방향 포함)

#### 4.4.2 마커 동기화
- **위치 동기화**: `position_changed` 이벤트로 마커 위치 업데이트
- **방향 동기화**: `pov_changed` 이벤트로 마커 회전
- **앵커**: 중심 (size/2, size/2)
- **회전**: `pov.pan` 각도에 따라 SVG 마커 회전

#### 4.4.3 컨테이너 크기 처리
- **문제**: CSS 트랜지션으로 인한 크기 0 이슈
- **해결**: 컨테이너 크기 확인 후 파노라마 생성
- **리사이즈**: 파노라마 초기화 후 `resize` 이벤트 트리거

### 4.5 검색 로직

#### 4.5.1 자동완성 검색
1. **입력 감지**: `handleInput` 함수
2. **API 호출**: Kakao Places API `keywordSearch`
3. **결과 표시**: 최대 10개 제안 표시
4. **선택 처리**: `selectItem` 함수로 위치 이동

#### 4.5.2 검색 기록 관리
- **저장**: localStorage에 최대 5개 저장
- **형식**: JSON 배열
- **표시**: 검색 입력 필드 포커스 시 기록 표시
- **중복 제거**: 동일한 장소명은 최신 것으로 교체

### 4.6 전체화면 로직

#### 4.6.1 전체화면 전환
- **상태**: `fullscreenPane: 'left' | 'right' | null`
- **전환 방식**: CSS 클래스 변경으로 패널 표시/숨김
- **리사이즈 처리**: 전환 후 100ms 지연 후 `resize` 이벤트 발생

#### 4.6.2 레이아웃 변경
- **일반 모드**: `flex-1` (동일 크기)
- **전체화면**: `h-full w-full` (전체 화면)
- **트랜지션**: 300ms ease-in-out

### 4.7 에러 처리 및 예외 상황

#### 4.7.1 SDK 로딩 대기
- **체크 주기**: 300ms 간격
- **로딩 표시**: SDK 로드 완료 전까지 "Loading..." 표시
- **초기화**: SDK 로드 완료 후 맵 인스턴스 생성

#### 4.7.2 거리뷰 오류 처리
- **파노라마 없음**: `error` 이벤트로 거리뷰 자동 종료
- **컨테이너 크기 0**: 재시도 메커니즘 (200ms 지연)

#### 4.7.3 무한 루프 방지
- **플래그 사용**: `isDragging`, `isProgrammaticUpdate`
- **타이밍 제어**: `setTimeout`으로 상태 업데이트 지연

### 4.8 성능 최적화

#### 4.8.1 이벤트 리스너 관리
- **중복 방지**: 리스너 등록 전 기존 리스너 제거
- **정리**: 컴포넌트 언마운트 시 리스너 제거

#### 4.8.2 상태 업데이트 최적화
- **조건부 업데이트**: `shouldUpdate` 함수로 불필요한 업데이트 방지
- **디바운싱**: 빠른 연속 업데이트 방지

#### 4.8.3 리소스 관리
- **맵 인스턴스 재사용**: 맵 제공자 변경 시에만 재생성
- **오버레이 정리**: 모드 변경 시 이전 오버레이 제거

---

## 부록

### A. 기술 스택
- **프레임워크**: React 19.2.3
- **스타일링**: Tailwind CSS
- **맵 API**: 
  - Google Maps JavaScript API
  - Kakao Maps JavaScript API
  - Naver Maps JavaScript API
- **빌드 도구**: Vite
- **언어**: TypeScript

### B. 주요 파일 구조
```
components/
  ├── Header.tsx          # 헤더 컴포넌트
  ├── MapPane.tsx         # 맵 패널 컴포넌트
  ├── KakaoGisToolbar.tsx # 카카오맵 GIS 도구
  └── FileUpload.tsx      # 파일 업로드 컴포넌트 (향후 사용)
App.tsx                   # 메인 앱 컴포넌트
types.ts                  # TypeScript 타입 정의
```

### C. 주요 상수
- **미니맵 크기**: 240px × 240px
- **검색 기록 최대 개수**: 5개
- **검색 제안 최대 개수**: 10개
- **트랜지션 시간**: 300ms
- **SDK 체크 간격**: 300ms

---

**문서 버전**: 1.0  
**최종 수정일**: 2026-01-16

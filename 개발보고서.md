# Advanced Dual Map Viewer - 개발보고서

**프로젝트명**: Advanced Dual Map Viewer (cc-dmv2)  
**작성일**: 2026년 1월 17일  
**프로젝트 상태**: 활성 개발 중

---

## 1. 프로젝트 개요

### 1.1 목적
Advanced Dual Map Viewer는 Google, Kakao, Naver 등 다양한 지도 서비스를 통합하여 이중 창(Dual-Pane) 방식으로 동시에 비교 및 동기화하는 고급 GIS(지리정보시스템) 도구입니다.

### 1.2 주요 기능
- **이중 맵 뷰어**: 좌우 두 개의 맵 패널에서 서로 다른 맵 제공자의 지도를 동시에 표시
- **맵 동기화**: 한쪽 맵의 위치, 줌 레벨 변경 시 다른 쪽 맵도 실시간 동기화
- **다중 맵 제공자 지원**: Google Maps, Kakao Maps, Naver Maps
- **위성 이미지 모드**: 각 맵의 위성/일반 모드 전환 가능
- **거리뷰(StreetView)**: Naver 거리뷰 파노라마 기능 통합
- **GIS 도구 모음**: 거리 측정, 면적 측정, 기본 모드 전환
- **위치 검색**: Kakao Places API를 통한 장소 자동완성 검색
- **검색 히스토리**: 이전 검색 기록 관리
- **전체화면 모드**: 개별 맵 패널 확대/축소
- **지오로케이션**: 현재 위치 자동 감지

---

## 2. 기술 스택

### 2.1 핵심 기술
- **프론트엔드 프레임워크**: React 19.2.3
- **언어**: TypeScript 5.8.2
- **빌드 도구**: Vite 6.2.0
- **스타일링**: CSS-in-JS (인라인 스타일)

### 2.2 외부 API/SDK
- **Google Maps API**: 맵 표시 및 기본 기능
- **Kakao Maps API**: 맵 표시, Places 검색 기능
- **Naver Maps API**: 맵 표시, 거리뷰 파노라마
- **Geolocation API**: 브라우저 위치 정보

### 2.3 개발 도구
- Node.js (의존성 관리)
- npm (패키지 매니저)

---

## 3. 프로젝트 구조

```
cc-dmv2/
├── App.tsx              # 메인 애플리케이션 컴포넌트
├── index.tsx            # React 앱 진입점
├── index.html           # HTML 템플릿
├── types.ts             # TypeScript 타입 정의
├── vite.config.ts       # Vite 설정 파일
├── tsconfig.json        # TypeScript 설정
├── package.json         # 프로젝트 의존성 및 스크립트
├── metadata.json        # 앱 메타데이터
├── README.md            # 프로젝트 설명
├── NAVER_STREETVIEW_FIX_REPORT.md  # 네이버맵 거리뷰 버그 수정 리포트
└── components/
    ├── Header.tsx       # 상단 헤더 (검색, 맵 선택, 도구)
    ├── MapPane.tsx      # 맵 표시 컴포넌트
    └── KakaoGisToolbar.tsx  # GIS 도구 모음
```

---

## 4. 핵심 컴포넌트 설명

### 4.1 App.tsx - 메인 애플리케이션 컴포넌트
**역할**: 전체 애플리케이션의 상태 관리 및 컴포넌트 조율

**주요 상태**:
- `globalState`: 현재 맵 위치(위도, 경도, 줌 레벨)
- `leftConfig`: 좌측 패널의 맵 설정 (제공자, 위성모드)
- `rightConfig`: 우측 패널의 맵 설정 (제공자, 위성모드)
- `searchPos`: 검색된 위치 정보
- `fullscreenPane`: 전체화면 모드 상태
- `streetViewState`: 거리뷰 활성 상태

**주요 기능**:
- 전역 상태 동기화
- 검색 결과 처리
- 풀스크린 토글

### 4.2 Header.tsx - 상단 헤더
**역할**: 사용자 입력 인터페이스 제공

**주요 기능**:
- 위치 검색 (Kakao Places API 활용)
- 검색 자동완성
- 검색 히스토리 관리
- 좌/우 맵 제공자 선택
- 위성 이미지 모드 토글
- 지오로케이션으로 현재 위치 이동

**기술 상세**:
- Kakao Places 검색 API 통합
- 검색 제안 수집 및 표시
- 로컬스토리지 기반 히스토리 관리
- 검색 입력 필드와 드롭다운 UI

### 4.3 MapPane.tsx - 맵 표시 컴포넌트
**역할**: 개별 맵 렌더링 및 상호작용

**지원하는 맵 제공자**:
1. **Google Maps**: Google Maps API v3
2. **Kakao Maps**: Kakao 지도 API
3. **Naver Maps**: Naver 지도 API

**주요 기능**:
- 맵 초기화 및 렌더링
- 마커 표시
- 줌/팬 상호작용
- 위성/기본 레이어 전환
- 클릭 이벤트 처리

**라이프사이클**:
- `useEffect`로 맵 SDK 로드 감지
- 지도 생성 및 설정
- 이벤트 리스너 등록
- 상태 변경 시 맵 동기화

### 4.4 KakaoGisToolbar.tsx - GIS 도구 모음
**역할**: 거리 측정, 면적 측정 등 고급 GIS 기능 제공

**지원 모드**:
- `DEFAULT`: 기본 모드
- `ROADVIEW`: 거리뷰 활성화
- `DISTANCE`: 거리 측정 모드
- `AREA`: 면적 측정 모드

**기능**:
- 다각형/선 그리기
- 거리/면적 계산
- 측정 결과 표시
- 도구 상태 관리

---

## 5. 타입 정의 (types.ts)

```typescript
// 맵 상태
interface MapState {
  lat: number;      // 위도
  lng: number;      // 경도
  zoom: number;     // 줌 레벨
}

// 맵 제공자 타입
type MapVendor = 'google' | 'kakao' | 'naver';

// 개별 패널 설정
interface PaneConfig {
  type: MapVendor;     // 맵 제공자
  isSatellite: boolean; // 위성 모드 여부
}

// 검색 결과
interface SearchResult {
  place_name: string;
  road_address_name: string;
  address_name: string;
  x: string;  // 경도
  y: string;  // 위도
}

// 검색 히스토리
interface HistoryItem {
  name: string;
  lat: number;
  lng: number;
}

// GIS 모드
enum GISMode {
  DEFAULT = 'default',
  ROADVIEW = 'roadview',
  DISTANCE = 'distance',
  AREA = 'area'
}
```

---

## 6. 주요 기술 과제 및 해결 방안

### 6.1 Naver 거리뷰 파노라마 렌더링 문제
**문제**: 거리뷰 활성화 시 파노라마 이미지가 표시되지 않는 현상

**근본 원인**: 파노라마 컨테이너의 크기가 0px인 상태에서 API 초기화 시도

**해결 방안**:
- CSS 애니메이션 완료 대기 (`transitionend` 이벤트)
- 컨테이너 실제 크기 확인 후 API 초기화
- `ResizeObserver` 활용 (향후 개선)

**참고**: `NAVER_STREETVIEW_FIX_REPORT.md` 참조

### 6.2 맵 동기화
**문제**: 여러 맵이 실시간으로 동기화되어야 함

**해결 방안**:
- React 전역 상태 활용
- `useCallback` 메모이제이션으로 성능 최적화
- 각 맵 렌더러에서 상태 변경 감지

### 6.3 다중 맵 SDK 로딩
**문제**: 여러 맵 SDK 동시 로드로 인한 충돌 및 성능 저하

**해결 방안**:
- Window 전역 객체에 SDK 참조 저장
- 각 SDK의 로드 완료 감지
- 조건부 초기화

---

## 7. 사용자 플로우

```
앱 시작
  ↓
초기 위치: 서울 명동 (37.5665°N, 126.9780°E)
  ↓
Google Maps (위성) + Kakao Maps (기본) 로드
  ↓
사용자 검색 입력
  ↓
자동완성 제안 표시
  ↓
위치 선택
  ↓
전역 상태 업데이트
  ↓
양쪽 맵 동시 이동
  ↓
GIS 도구 선택 (거리/면적 측정, 거리뷰 등)
```

---

## 8. 배포 및 실행

### 8.1 로컬 실행
```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 프로덕션 빌드
npm build

# 빌드 결과 미리보기
npm run preview
```

### 8.2 API 키 설정
- Google Maps API 키 필요
- Kakao Maps API 키 필요
- Naver Maps API 키 필요
- `.env.local` 파일에 설정

### 8.3 AI Studio 배포
- AI Studio 플랫폼을 통해 배포됨
- 링크: https://ai.studio/apps/drive/1KP38qyNiBAnnr41-DZJ55VMftVQ7fj1L

---

## 9. 현재 알려진 이슈 및 개선 사항

### 9.1 해결된 이슈
- ✅ Naver 거리뷰 파노라마 렌더링 문제 (수정 완료)

### 9.2 향후 개선 예정
- [ ] ResizeObserver를 활용한 더 강건한 컨테이너 크기 감시
- [ ] 다른 거리뷰 제공자 지원 (Google Street View)
- [ ] 측정 결과 내보내기 기능
- [ ] 지도 기록 저장 및 로드 기능
- [ ] 어두운 테마 지원
- [ ] 모바일 반응형 디자인 개선

---

## 10. 의존성 분석

### 10.1 프로덕션 의존성
| 패키지 | 버전 | 용도 |
|--------|------|------|
| react | ^19.2.3 | UI 프레임워크 |
| react-dom | ^19.2.3 | React DOM 렌더링 |

### 10.2 개발 의존성
| 패키지 | 버전 | 용도 |
|--------|------|------|
| @vitejs/plugin-react | ^5.0.0 | Vite React 플러그인 |
| typescript | ~5.8.2 | 타입스크립트 컴파일러 |
| vite | ^6.2.0 | 빌드 도구 |
| @types/node | ^22.14.0 | Node.js 타입 정의 |

---

## 11. 성능 고려사항

### 11.1 최적화된 부분
- React 메모이제이션 (`useCallback`)
- 컴포넌트 분리로 불필요한 리렌더링 방지
- 이벤트 위임
- CSS 애니메이션 활용

### 11.2 향후 최적화 계획
- 코드 스플릿팅
- 이미지 최적화
- 지연 로딩 (Lazy Loading)
- 번들 크기 최소화

---

## 12. 보안 고려사항

### 12.1 현재 적용된 보안
- 브라우저 지오로케이션 권한 요청
- API 키 환경 변수 관리

### 12.2 향후 보안 강화
- CSP (Content Security Policy) 설정
- XSS 방지 (React 자동 이스케이핑)
- CORS 정책 준수
- 입력값 검증 및 살균

---

## 13. 문서 및 참고자료

- [README.md](README.md) - 프로젝트 기본 설정 및 실행 방법
- [NAVER_STREETVIEW_FIX_REPORT.md](NAVER_STREETVIEW_FIX_REPORT.md) - 네이버맵 거리뷰 버그 분석 및 해결 과정
- [types.ts](types.ts) - 타입 정의 및 인터페이스

---

## 14. 결론

Advanced Dual Map Viewer는 React와 TypeScript를 기반으로 한 현대적인 GIS 웹 애플리케이션입니다. 다양한 지도 서비스의 통합, 실시간 동기화, 고급 측정 도구 등을 통해 지도 비교 및 분석 작업을 효율적으로 수행할 수 있도록 설계되었습니다.

**주요 강점**:
- 다중 지도 서비스 지원 및 실시간 동기화
- 직관적인 사용자 인터페이스
- 확장 가능한 컴포넌트 구조
- 타입 안정성 (TypeScript)

**개발 상태**: 활발한 개발 중이며, 사용자 피드백에 따른 지속적인 개선이 예상됩니다.

---

**최종 수정 일자**: 2026년 1월 17일  
**담당 개발자**: [개발팀]

# 미니맵 위치 변경 미적용 문제 해결 보고서

## 📋 문제 개요

**증상**: 코드에서 미니맵 위치를 `top-3 left-3`에서 `bottom-3 left-3`로 변경했으나, 실제 화면에서는 여전히 왼쪽 위에 표시됨

**코드 상태**: `components/MapPane.tsx` 1596번 라인에 `bottom-3 left-3`로 설정되어 있음

**영향 범위**: 모든 맵 제공자 (Google, Kakao, Naver)의 거리뷰 미니맵

---

## 🔍 원인 분석

### 가능한 원인들

#### 1. **맵 API가 컨테이너에 직접 스타일 적용** ⭐ 가장 가능성 높음

맵 API (Google Maps, Kakao Maps, Naver Maps)가 초기화 시 컨테이너 요소에 직접 인라인 스타일을 적용할 수 있습니다.

**문제 시나리오**:
1. React가 `bottom-3 left-3` 클래스를 적용
2. 맵 API 초기화 시 컨테이너에 `style="position: absolute; top: 0; left: 0;"` 등 직접 설정
3. 인라인 스타일이 CSS 클래스보다 우선순위가 높아 `bottom-3`가 무시됨

#### 2. **Tailwind CSS 클래스 컴파일 문제**

Tailwind CSS가 `bottom-3` 클래스를 제대로 생성하지 않았을 수 있습니다.

**확인 방법**: 브라우저 개발자 도구에서 요소의 계산된 스타일 확인

#### 3. **브라우저 캐시 문제**

이전 CSS 파일이 캐시되어 새로운 클래스가 적용되지 않았을 수 있습니다.

#### 4. **트랜지션 중 위치 재설정**

300ms 트랜지션 중에 맵 API가 위치를 재설정할 수 있습니다.

---

## ✅ 해결 방안

### 방안 1: 인라인 스타일로 명시적 설정 (권장) ⭐

CSS 클래스 대신 인라인 스타일을 사용하여 맵 API의 스타일 오버라이드를 방지합니다.

**수정 코드**:
```tsx
<div 
  ref={containerRef} 
  className={`transition-all duration-300 ease-in-out bg-white
    ${isStreetViewActive 
      ? 'absolute w-[240px] h-[240px] z-[100] border-4 border-white shadow-2xl rounded-lg overflow-hidden' 
      : 'w-full h-full z-0'
    }`}
  style={isStreetViewActive ? {
    position: 'absolute',
    bottom: '12px',  // bottom-3 = 0.75rem = 12px
    left: '12px',    // left-3 = 0.75rem = 12px
    width: '240px',
    height: '240px'
  } : undefined}
/>
```

**장점**:
- 인라인 스타일은 CSS 클래스보다 우선순위가 높음
- 맵 API의 스타일 오버라이드 방지
- 명시적 위치 설정으로 예측 가능한 동작

### 방안 2: 맵 초기화 후 스타일 재적용

맵 API 초기화 완료 후 스타일을 다시 적용합니다.

**수정 코드**:
```tsx
// 맵 초기화 후 스타일 재적용
useEffect(() => {
  if (isStreetViewActive && containerRef.current && mapRef.current) {
    // 맵 리사이즈 후 스타일 재적용
    setTimeout(() => {
      if (containerRef.current) {
        containerRef.current.style.position = 'absolute';
        containerRef.current.style.bottom = '12px';
        containerRef.current.style.left = '12px';
        containerRef.current.style.top = 'auto';
        containerRef.current.style.right = 'auto';
      }
    }, 350); // 트랜지션 완료 후 (300ms + 여유)
  }
}, [isStreetViewActive, config.type]);
```

### 방안 3: CSS 클래스 강제 적용

`!important`를 사용하거나 더 구체적인 선택자 사용 (비권장)

**수정 코드**:
```tsx
className={`transition-all duration-300 ease-in-out bg-white
  ${isStreetViewActive 
    ? 'absolute !bottom-3 !left-3 w-[240px] h-[240px] z-[100] border-4 border-white shadow-2xl rounded-lg overflow-hidden' 
    : 'w-full h-full z-0'
  }`}
```

**단점**: Tailwind의 `!important` 사용은 유지보수성 저하

### 방안 4: 브라우저 캐시 클리어

1. 하드 리프레시: `Ctrl + Shift + R` (Windows) / `Cmd + Shift + R` (Mac)
2. 개발자 도구에서 "Disable cache" 체크
3. 브라우저 캐시 완전 삭제

---

## 🎯 권장 해결 방법

**방안 1 (인라인 스타일)**을 권장합니다. 이유:

1. **확실한 우선순위**: 인라인 스타일은 모든 CSS보다 우선순위가 높음
2. **맵 API 호환성**: 맵 API가 스타일을 변경해도 인라인 스타일이 유지됨
3. **명시적 제어**: 위치를 정확히 제어 가능
4. **유지보수성**: 코드에서 위치 변경이 명확함

---

## 📝 구현 예시

### 최종 수정 코드

```tsx
{/* 1. Main Map / Mini Map Container */}
<div 
  ref={containerRef} 
  className={`transition-all duration-300 ease-in-out bg-white
    ${isStreetViewActive 
      ? 'absolute w-[240px] h-[240px] z-[100] border-4 border-white shadow-2xl rounded-lg overflow-hidden' 
      : 'w-full h-full z-0'
    }`}
  style={isStreetViewActive ? {
    position: 'absolute',
    bottom: '12px',  // bottom-3 = 0.75rem = 12px
    left: '12px',    // left-3 = 0.75rem = 12px
    top: 'auto',
    right: 'auto',
    width: '240px',
    height: '240px'
  } : {}}
/>
```

### 추가 보완: 맵 리사이즈 후 스타일 재확인

```tsx
// 맵 리사이즈 후 미니맵 위치 재확인
useEffect(() => {
  if (isStreetViewActive && containerRef.current) {
    const timer = setTimeout(() => {
      if (containerRef.current) {
        // 인라인 스타일로 위치 강제 설정
        containerRef.current.style.position = 'absolute';
        containerRef.current.style.bottom = '12px';
        containerRef.current.style.left = '12px';
        containerRef.current.style.top = 'auto';
        containerRef.current.style.right = 'auto';
      }
    }, 350); // 트랜지션 완료 후
    
    return () => clearTimeout(timer);
  }
}, [isStreetViewActive]);
```

---

## 🔧 디버깅 방법

### 1. 브라우저 개발자 도구 확인

1. F12로 개발자 도구 열기
2. Elements 탭에서 미니맵 컨테이너 요소 선택
3. Computed 탭에서 `bottom`, `left`, `top`, `right` 값 확인
4. Styles 탭에서 적용된 스타일 확인

**예상 결과**:
- `bottom: 12px` (또는 0.75rem)
- `left: 12px` (또는 0.75rem)
- `top: auto`
- `right: auto`

### 2. 인라인 스타일 확인

Elements 탭에서 요소의 `style` 속성 확인:
```html
<div style="position: absolute; bottom: 12px; left: 12px; ...">
```

### 3. CSS 클래스 확인

Elements 탭에서 `class` 속성에 `bottom-3 left-3`가 포함되어 있는지 확인

---

## ✅ 검증 체크리스트

- [ ] 코드에 `bottom-3 left-3` 또는 인라인 스타일 `bottom: 12px; left: 12px;` 적용
- [ ] 브라우저 개발자 도구에서 실제 `bottom`, `left` 값 확인
- [ ] 맵 API 초기화 후에도 위치가 유지되는지 확인
- [ ] 모든 맵 제공자 (Google, Kakao, Naver)에서 동일하게 작동하는지 확인
- [ ] 트랜지션 중에도 위치가 유지되는지 확인

---

## 📚 교훈

### CSS 우선순위 이해

1. **인라인 스타일** > **ID 선택자** > **클래스 선택자** > **태그 선택자**
2. 맵 API는 종종 인라인 스타일을 사용하므로, CSS 클래스만으로는 오버라이드가 어려울 수 있음
3. 중요한 위치 스타일은 인라인 스타일로 명시적으로 설정하는 것이 안전

### 맵 API와의 스타일 충돌

- 맵 API는 성능 최적화를 위해 컨테이너에 직접 스타일을 적용할 수 있음
- React의 상태 변경과 맵 API의 스타일 적용 타이밍이 다를 수 있음
- 맵 리사이즈 후 스타일 재확인이 필요할 수 있음

---

**작성일**: 2026-01-16  
**문제 유형**: CSS 우선순위 및 맵 API 스타일 충돌  
**해결 상태**: 해결 방안 제시 완료
